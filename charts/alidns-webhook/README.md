alidns-webhook
==============
Cert-manager ACME DNS webhook provider for alidns

Current chart version is `0.1.0`

Source code can be found [here](https://github.com/georgedriver/helm-charts)

## Installation

### Add Helm repository

```shell
helm repo add georgedriver https://georgedriver.github.io/helm-charts
helm repo update
```

```shell
helm install georgedriver/alidns-webhook \
  --set alicloud_access_key=<alicloud_access_key> \
  --set alicloud_secret_key=<alicloud_secret_key> \
  --set email="test@test.com" \
  --set domain="test.com"
```

## Configuration

The following table lists the configurable parameters of the chart and the default values.

## Chart Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| alicloud_access_key | string | `""` | ALICLOUD_ACCESS_KEY to handle the Alicloud DNS records |
| alicloud_secret_key | string | `""` | ALICLOUD_SECRET_KEY to handle the Alicloud DNS records |
| domain | string | `"test.com"` | The domain we're using for alidns-webhook |
| email | string | `"test@test.com"` | A validated email address for cert-manager |

## Changes

- Change `acme.yourcompany.com` to `cert-manager.io`, cause the `Certificate` generated by `Ingress` will always use the group `cert-manager.io` as its `issuerRef`

- Hook all the steps in [alidns-webhook](https://github.com/pragkent/alidns-webhook) this helm chart, include the test `Certificate`

## Usage

Example ingress

```yaml
cat << EOF | kubectl apply -f -
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: basic-ingress
  annotations:
    kubernetes.io/ingress.class: "nginx"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
spec:
  tls:
  - hosts:
    - vault11.mirana.test.com
    secretName: quickstart-example-tls
  rules:
  - host: vault11.mirana.test.com
    http:
      paths:
      - backend:
          serviceName: nginx
          servicePort: 80
EOF
```

## Ref

- [cert-manager](https://cert-manager.io/docs/configuration/acme/dns01/#webhook)
- [alidns-webhook](https://github.com/pragkent/alidns-webhook)
